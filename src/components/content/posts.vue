<template>
  <div class="container posts">

    <!-- posts page title -->
    <div class="content-heading is-flex">
      <h3 class="is-size-3">Posts</h3>
      <router-link to="/admin/posts/new" class="button is-info">Add New</router-link>
    </div>

    <!-- the new post form loaded via vue router -->
    <router-view :add-post="addPost" :update-post="updatePost" :posts="posts"></router-view>

    <!-- posts list -->
    <div class="box">
      <table class="table is-fullwidth is-striped">
        <thead>
          <tr>
            <th>Title</th>
            <th>Author</th>
            <th>tags</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(post, index) in posts" :key="index">
            <td class="post-title-cell">
              <router-link :to="'/admin/posts/edit/' + post['.key']">
                {{post.title}}
              </router-link>

              <div class="actions">
                <router-link :to="'/admin/posts/edit/' + post['.key']">
                  <span class="has-text-info">Edit</span>
                </router-link>
                <span @click="deletePost(post)" class="has-text-danger">Delete</span>
              </div>
            </td>
            <td class="post-author-cell">{{post.author}}</td>
            <td class="post-tags-cell">{{post.tags}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</template>

<script>
import { postsRef } from '../../config';

export default {
  firebase: {
    posts: postsRef
  },
  methods: {
    addPost(post) {
      // add a new post if the title is not empty
      if (post.title) {
        this.$firebaseRefs.posts.push(post);
      }
    },
    deletePost(post) {
      // delete post form firebase
      this.$firebaseRefs.posts.child(post['.key']).remove();
    },
    updatePost(post) {
      // update the post if the title is not empty
      if (post.title) {
        // create a copy of the item
        let tempPost = { ...post };
        // remove the .key attribute
        delete tempPost['.key'];
        this.$firebaseRefs.posts.child(post['.key']).set(tempPost);
      }
    }
  }
}

</script>

<style lang="scss" scoped>
.posts {
  .post-title-cell {
    width: 50%;
  }
  .post-author-cell {
    width: 25%;
  }
  .post-tags-cell {
    width: 25%;
  }
}
</style>
